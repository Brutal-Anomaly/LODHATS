@using WebMatrix.Data
@functions{

    /////////////////REMOVE////////////////////

    public static void deleteUser(int userID)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "DELETE userid FROM users WHERE userid = '@0'";
        db.Execute(commandText, userID);
    }


    public static void deleteCharacter(int characterID)
    {

        var db = Database.Open("MySQLDB");
        var commandText = "DELETE characterid FROM character WHERE characterid = '@0'";
        db.Execute(commandText, characterID);

    }

    public static void deleteParty(int partyID)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "DELETE partyid FROM party WHERE partyid = '@0'";
        db.Execute(commandText, partyID);
    }

    /////////////////ADD//////////////////////

    public static void addUser(User user)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "INSERT INTO users (userid, password, username, firstname, lastname, email, admin)" +
                             "VALUES (@0, @1, @2, @3, @4, @5, @6)";
        db.Execute(commandText, user.getUserID(), user.getPassword(), user.getEmail(), user.isAdmin());
    }

    public static void addCharacter(Character character)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "INSERT INTO character (userid, charactername, charactergender, characterclass, characterrace, characterlevel, exp, background, alignment, strength, dex, constitution, intelligence, wisdom, speed, charisma, inspiration, skillsacrobatics, skillsanimalhandling, skillsarcana, skillsathletics, skillsdeception, skillshistory, skillsinsight, skillsintimidation, skillsinvestigation, skillsmedicine, skillsnature, skillsperception, skillsperformance, skillspersuasion, skillsreligion, skillssleightofhand, skillsstealth, skillssurvival, age, eyes, skin, hair) VALUES (@0, @1, @2, @3, @4, @5, @6, @7, @8, @9, @10, @11, @12, @13, @14, @15, @16, @17, @18, @19, @20, @21, @22, @23, @24, @25, @26, @27, @28, @29, @30, @31, @32, @33, @34, @35, @36, @37, @38)";
        db.Execute(commandText, character.getUser(), character.getName(), character.getGender(), character.getClass(), character.getRace(), character.getLevel().ToString(), character.getEXP().ToString(), character.getBackground(), character.getAlignment(), character.getStrength().ToString(), character.getDex().ToString(), character.getConstitution().ToString(), character.getIntelligence(), character.getWisdom(), character.getSpeed().ToString(), character.getCharisma().ToString(), character.getInspiration().ToString(), character.getAcrobatics().ToString(), character.getAnimalHandling().ToString(), character.getArcana().ToString(), character.getAthletics().ToString(), character.getDeception().ToString(), character.getHistory().ToString(), character.getInsight().ToString(), character.getIntimidation().ToString(), character.getInspiration().ToString(), character.getMedicine().ToString(), character.getNature().ToString(), character.getPerception().ToString(), character.getPerformance().ToString(), character.getPersuasion().ToString(), character.getReligion().ToString(), character.getSleightOfHand().ToString(), character.getStealth().ToString(), character.getSurvival().ToString(), character.getAge().ToString(), character.getEyes().ToString(), character.getSkin().ToString(), character.getHair().ToString());
    }

    public static void addParty(Party party)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "INSERT INTO party (partyid, dm, users, characters, inventory)" +
                             "VALUES (@0, @1, @2, @3, @4)";
        db.Execute(commandText, party.getPartyID(), party.getDM(), party.getUsers(), party.getCharacters(), party.getInventory());
    }

    /////////////////PARTY////////////////////

    public static void removeUserFromParty(int partyID, int userID)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "DELETE userid FROM party WHERE partyid = '@0', userid = '@1'";
        db.Execute(commandText, partyID, userID);
    }

    public static void addUserToParty(int partyID, int userID, int characterID)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "INSERT INTO party (userid, characterid) VALUES (@0, @1) WHERE partyid = '@2'";
        db.Execute(commandText, userID, characterID, partyID);
    }

    /////////////////GET////////////////////

    public static User getUser(string email)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "SELECT * FROM users WHERE email ='@0'";

        int userID = 0;
        string password = "";
        bool admin = false;
        foreach (var row in db.Query(commandText, email))
        {
            userID = row.userid;
            password = row.password;
            email = row.email;
            admin = row.admin;
        }
        return new User(userID, password, email, admin);
    }

    public static User[] getUsers()
    {
        var db = Database.Open("MySQLDB");
        var commandText = "SELECT * FROM users";

        List<User> userList = new List<User>();

        foreach (var row in db.Query(commandText))
        {
            int id = row.userid;
            string password = row.password;
            string username = row.username;
            string first = row.firstname;
            string last = row.lastname;
            string email = row.email;
            bool admin = row.admin;

            userList.Add(new User(id, password, email, admin));
        }

        User[] users = userList.ToArray();
        return users;
    }

    public static Character getCharacter(int characterID)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "SELECT * FROM character WHERE characterid =@0";        

        int userID = 0;
        string characterName = "";
        string characterGender =  "";
        string characterClass= "";
        string characterRace= "";
        int characterLevel= 0;
        int exp = 0;
        string background= "";
        string alignment= "";
        int strength= 0;
        int dex= 0;
        int constitution= 0;
        int intelligence= 0;
        int wisdom= 0;
        int speed = 0;
        int charisma= 0;
        int inspiration= 0;
        int skillsAcrobatics= 0;
        int skillsAnimalHandling= 0;
        int skillsArcana= 0;
        int skillsAthletics= 0;
        int skillsDeception= 0;
        int skillsHistory= 0;
        int skillsInsight= 0;
        int skillsIntimidation= 0;
        int skillsInvestigation= 0;
        int skillsMedicine= 0;
        int skillsNature= 0;
        int skillsPerception= 0;
        int skillsPerformance= 0;
        int skillsPersuasion= 0;
        int skillsReligion= 0;
        int skillsSleightOfHand= 0;
        int skillsStealth= 0;
        int skillsSurvival= 0;
        int age= 0;
        string eyeColor= "";
        string skinColor= "";
        string hairColor= "";

        //create character
        foreach (var row in db.Query(commandText, characterID))
        {
            userID = row.userid;
            characterName = row.charactername;
            characterGender = row.charactergender;
            characterClass = row.characterclass;
            characterRace = row.characterrace;
            characterLevel = row.characterlevel;
            exp = row.exp;
            background = row.background;
            alignment = row.alignment;
            strength = row.strength;
            dex = row.dex;
            constitution = row.constitution;
            intelligence = row.intelligence;
            wisdom = row.wisdom;
            speed = row.speed;
            charisma = row.charisma;
            inspiration = row.inspiration;
            skillsAcrobatics = row.skillsacrobatics;
            skillsAnimalHandling = row.skillsanimalhandling;
            skillsArcana = row.skillsarcana;
            skillsAthletics = row.skillsathletics;
            skillsDeception = row.skillsdeception;
            skillsHistory = row.skillshistory;
            skillsInsight = row.skillsinsight;
            skillsIntimidation = row.skillsintimidation;
            skillsInvestigation = row.skillsinvestigation;
            skillsMedicine = row.skillsmedicine;
            skillsNature = row.skillsnature;
            skillsPerception = row.skillsperception;
            skillsPerformance = row.skillsperformance;
            skillsPersuasion = row.skillspersuasion;
            skillsReligion = row.skillsreligion;
            skillsSleightOfHand = row.skillssleightofhand;
            skillsStealth = row.skillsstealth;
            skillsSurvival = row.skillssurvival;
            age = row.age;
            eyeColor = row.eyes;
            skinColor = row.skin;
            hairColor = row.hair;
        }
        return new Character( characterID,  userID,  characterName,  characterGender,  characterClass,  characterRace,  characterLevel, exp, background,  alignment,  strength,  dex,  constitution,  intelligence,  wisdom,  speed, charisma, inspiration, skillsAcrobatics,  skillsAnimalHandling,  skillsArcana,  skillsAthletics,  skillsDeception,  skillsHistory,  skillsInsight,  skillsIntimidation,  skillsInvestigation,  skillsMedicine,  skillsNature,  skillsPerception,  skillsPerformance,  skillsPersuasion,  skillsReligion,  skillsSleightOfHand,  skillsStealth,  skillsSurvival,  age,  eyeColor,  skinColor, hairColor);
    }

    public static Character[] getCharacters(int userID)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "SELECT * FROM character WHERE userid ='@0'";

        List<Character> charList = new List<Character>();

        //create characters
        foreach (var row in db.Query(commandText, userID))
        {
            int characterID = row.characterid;
            string characterName = row.charactername;
            string characterGender = row.charactergender;
            string characterClass = row.characterclass;
            string characterRace = row.characterrace;
            int characterLevel = row.characterlevel;
            int exp = row.exp;
            string background = row.background;
            string alignment = row.alignment;
            int strength = row.strength;
            int dex = row.dex;
            int constitution = row.constitution;
            int intelligence = row.intelligence;
            int wisdom = row.wisdom;
            int speed = row.speed;
            int charisma = row.charisma;
            int inspiration = row.inspiration;
            int skillsAcrobatics = row.skillsacrobatics;
            int skillsAnimalHandling = row.skillsanimalhandling;
            int skillsArcana = row.skillsarcana;
            int skillsAthletics = row.skillsathletics;
            int skillsDeception = row.skillsdeception;
            int skillsHistory = row.skillshistory;
            int skillsInsight = row.skillsinsight;
            int skillsIntimidation = row.skillsintimidation;
            int skillsInvestigation = row.skillsinvestigation;
            int skillsMedicine = row.skillsmedicine;
            int skillsNature = row.skillsnature;
            int skillsPerception = row.skillsperception;
            int skillsPerformance = row.skillsperformance;
            int skillsPersuasion = row.skillspersuasion;
            int skillsReligion = row.skillsreligion;
            int skillsSleightOfHand = row.skillssleightofhand;
            int skillsStealth = row.skillsstealth;
            int skillsSurvival = row.skillssurvival;
            int age = row.age;
            string eyeColor = row.eyes;
            string skinColor = row.skin;
            string hairColor = row.hair;

            charList.Add(new Character(characterID, userID, characterName, characterGender, characterClass, characterRace, characterLevel, exp, background, alignment, strength, dex, constitution, intelligence, wisdom, speed, charisma, inspiration, skillsAcrobatics, skillsAnimalHandling, skillsArcana, skillsAthletics, skillsDeception, skillsHistory, skillsInsight, skillsIntimidation, skillsInvestigation, skillsMedicine, skillsNature, skillsPerception, skillsPerformance, skillsPersuasion, skillsReligion, skillsSleightOfHand, skillsStealth, skillsSurvival, age, eyeColor, skinColor, hairColor));
        }
        Character[] characters = charList.ToArray();
        return characters;
    }

    public static int getRecentEntry()
    {
        var db = Database.Open("MySQLDB");
        var row = db.QuerySingle("SELECT MAX(characterid) AS id FROM character");
        return row.id;
    }

    public static Party getParty(int partyID)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "SELECT * FROM party WHERE partyid =" + partyID;

        string name = "";
        int DM = 0;
        int[] users = null;
        int[] characters = null;
        string[] inventory = null;

        //create party
        foreach (var row in db.Query(commandText))
        {
            name = row.name;
            DM = row.dm;
            users = row.users;
            characters = row.characters;
            inventory = row.inventory;
        }

        return new Party(partyID, name, DM, users, characters, inventory);
    }

    public static Party[] getParties(int userID)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "SELECT * FROM party WHERE userid ='@'";

        List<Party> partyList = new List<Party>();

        //create characters
        foreach (var row in db.Query(commandText, userID))
        {
            int id = row.partyid;
            string name = row.name;
            int DM = row.dm;
            int[] users = row.users;
            int[] characters = row.characters;
            string[] inventory = row.inventory;
            partyList.Add(new Party(id, name, DM, users, characters, inventory));
        }

        Party[] parties = partyList.ToArray();
        return parties;
    }

    //////////////////UPDATE//////////////////////

    public static void updateCharacter(Character character)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "UPDATE character Set userid = '@0', charactername = '@1', charactergender = '@2', characterclass = '@3', characterrace = '@4', characterlevel = '@5', exp = '@6', background = '@7', alignment = '@8', strength = '@9', dex = '@10', constitution = '@11', intelligence = '@12', wisdom = '@13', speed = '@14', charisma = '@15', inspiration = '@16', skillsacrobatics = '@17', skillsanimalhandling = '@18', skillsarcana = '@19', skillsathletics = '@20', skillsdeception = '@21', skillshistory = '@22', skillsinsight = '@23', skillsintimidation = '@24', skillsinvestigation = '@25', skillsmedicine = '@26', skillsnature = '@27', skillsperception = '@28', skillsperformance = '@29', skillspersuasion = '@30', skillsreligion = '@31', skillssleightofhand = '@32', skillsstealth = '@33', skillssurvival = '@34', age = '@35', eyes = '@36', skin = '@37', hair = '@38' WHERE characterid = '@39'";
        db.Execute(commandText, character.getUser(), character.getName(), character.getGender(), character.getClass(), character.getRace(), character.getLevel(), character.getBackground(), character.getAlignment(), character.getStrength(), character.getDex(), character.getConstitution(), character.getIntelligence(), character.getWisdom(), character.getCharisma(), character.getInspiration(), character.getAcrobatics(), character.getAnimalHandling(), character.getArcana(), character.getAthletics(), character.getDeception(), character.getHistory(), character.getInsight(), character.getIntimidation(), character.getInspiration(), character.getMedicine(), character.getNature(), character.getPerception(), character.getPerformance(), character.getPersuasion(), character.getReligion(), character.getSleightOfHand(), character.getStealth(), character.getSurvival(), character.getAge(), character.getEyes(), character.getSkin(), character.getHair(), character.getID());
    }

    public static void updateParty(Party party)
    {
        var db = Database.Open("MySQLDB");
        var commandText = "UPDATE party SET name = '@0', dm = '@1', users = '@2', characters = '@3', inventory = '@4' WHERE partyid = '@5'";

        db.Execute(commandText, party.getDM(), party.getName(), party.getUsers(), party.getCharacters(), party.getInventory(), party.getPartyID());
    }

}