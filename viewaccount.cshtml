@{
    Layout = "~/_SiteLayout.cshtml";
    var db = Database.Open("MySQLDB");

    var email = "";

    //Get userid from the db by using the username
    if (Session["username"] != null)
    {
        email = (string)Session["username"];
    }
    else
    {
        email = "Account not logged in!";
    }

    var userid_query = "SELECT userid FROM users WHERE email ='" + email + "'";

    var userid = db.QueryValue(userid_query);

    var char_query = "SELECT * from character WHERE userid ='" + userid + "'";


    <!--


    "View Details" button below still needs functionality. Waiting on charcreator.cshtml issues to be resolved
    "View Party" button below still needs functionality. Waiting on party.cshtml issues to be resolved

    -->

}

<!DOCTYPE html>
<html>
<head>
    <title>Account</title>
</head>
<body>
    <h1>&nbsp;</h1>
    <div class="container">
        <div class="card">
            <div class="card-header bg-dark">
                <h3 style="color:white">Account Information</h3>
            </div>
            <div class="card-body bg-secondary">
                <div class="row">
                    <div class="col-sm-10 offset-md-1 col-md-8">
                        <h5 style="color:white">Email: @email</h5>
                    </div>
                    <div class="col-sm-2">
                        <h5 style="color:white">UserID: @userid</h5>
                    </div>
                </div>
            </div>
        </div>

        <br />

        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-header bg-dark">
                        <h3 style="color:white">Characters</h3>
                    </div>
                    <div class="card-body bg-secondary">
                        <div class="form-row">
                            <table class="table col-sm-12 table-hover table-dark table-borderless table-striped rounded">
                                <thead class="">
                                <td></td>
                                <td>Name</td>
                                <td>Gender</td>
                                <td>Level</td>
                                <td>Class</td>
                                <td></td>
                                </thead>
                                <tbody class="">
                                    <!--for loop for character table-->
                                    @foreach (var row in db.Query(char_query))
                                    {
                                    <tr>
                                        <td></td>
                                        <td>@row.charactername</td>
                                        <td>@row.charactergender</td>
                                        <td>@row.characterlevel</td>
                                        <td>@row.characterclass</td>
                                        <td></td>
                                        <td></td>
                                        <td><button type="button" class="btn-sm"><a style="color:black" href="charcreator.cshtml?characterid=@row.characterid">View Details</a></button></td>
                                        @{
                                            if (row.partyid != null)
                                            {
                                                //change the link to the party view page and pass the partyid
                                                <td><button type="button" class="btn-sm"><a style="color:black" href="party.cshtml?partyid=@row.partyid">View Party</a></button></td>
                                            }
                                            else
                                            {
                                                <td><button type="button" class="btn-sm"><a style="color:black" href="partyjoin.cshtml?characterid=@row.characterid">Join Party</a></button></td>
                                                //<td><button onclick="join_party()" type="button" class="btn-sm">Join Party</button></td>

                                            }
                                        }



                                    </tr>
                                    }

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>
